<!DOCTYPE html>
<html lang="en" data-mode="dark">
  <head prefix="og: http://ogp.me/ns#">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.92.0">
<meta name="theme" content="Color Your World -- gitlab.com/rmaguiar/hugo-theme-color-your-world">
























<title>Reference - Docker | </title>


<meta name="author" content="Rahil Rehan">
<meta name="description" content="Complete docker reference">


<meta name="robots" content="index follow">




  
    <link rel="canonical" href="https://rahilrehan.github.io/posts/0009-ref-docker/">
  








<meta property="og:site_name" content="">
<meta property="og:title" content="Reference - Docker">
<meta property="og:description" content="Complete docker reference">
  <meta property="og:url" content="https://rahilrehan.github.io/posts/0009-ref-docker/">








  <meta property="og:type" content="article">
  
  
    <meta property="article:published_time" content="2021-07-25">
    <meta property="article:modified_time" content="2021-07-25">
    <meta property="og:updated_time" content="2021-07-25">
  

  
    <meta property="article:author" content="Rahil Rehan">
  
  
  
  







  <meta name="twitter:dnt" content="on">












<meta name="theme-color" content="#222">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">



  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    
    
      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    
    
      
      
    

  

    
    

    
    
      
      
    

  

    
    

    

      
      
    

  

    
    

    
    
      
      
    

  

    
    

    
    
      
      
    

  

    
    

    

      
      
    

  

    
    

    
    
      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  

    
    

    

      
      
    

  







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebSite",
        "@id": "https:\/\/rahilrehan.github.io"
      },
      "headline": "Reference - Docker",
      "description": "Complete docker reference",
      
      "url": "https:\/\/rahilrehan.github.io\/posts\/0009-ref-docker\/",
      "inLanguage": "en",
      "datePublished": "2021-07-25",
      "dateModified": "2021-07-25",
      "wordCount" : "708",
      "publisher": {
        "@type": "Person",
        "name": "Rahil Rehan"
      },
      "author": {
        "@type": "Person",
        "name": "Rahil Rehan",
        "description": "I google things...",
        
      }
    }
  </script>






<link rel="stylesheet" href="https://rahilrehan.github.io/css/main.min.8e05f798b394986601b0549619b019d4fb9158b099e78d9b0070ef59a3ef192e.css" integrity="sha256-jgX3mLOUmGYBsFSWGbAZ1PuRWLCZ542bAHDvWaPvGS4=" crossorigin="anonymous">



<noscript>

  
  

  

    
      <meta name="theme-color" content="#7fc121">
    

  

  
  <link rel="stylesheet" href="https://rahilrehan.github.io/css/noscript.min.d2981530e31236824300f109882a46f4d23dffef8e9ddf6b1d309f1b843b1782.css" integrity="sha256-0pgVMOMSNoJDAPEJiCpG9NI9/&#43;&#43;Ond9rHTCfG4Q7F4I=" crossorigin="anonymous">

</noscript>



<link rel="preload" href="/fonts/open-sans-v17-latin-700.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="/fonts/open-sans-v17-latin-italic.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="/fonts/open-sans-v17-latin-regular.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="/fonts/oswald-v29-latin-700.woff2" as="font" crossorigin="anonymous">











<script src="https://rahilrehan.github.io/js/main.min.6291e9de07b9d50ccb74582d56dd1ad3b6015c25916f9fee32276f9e6bd85e3c.js" integrity="sha256-YpHp3ge51QzLdFgtVt0a07YBXCWRb5/uMidvnmvYXjw=" crossorigin="anonymous"></script>

  </head>

  <body>

    <header>
      

  <a href="/"></a>




  
    <nav aria-label="Main menu.">
      <ul>
        
          <li>
            <a class="btn" href="/">About</a>
          </li>
        
          <li>
            <a class="btn" href="/posts/">Posts</a>
          </li>
        
      </ul>
    </nav>
  


    </header>

    <div class="filler">
      

  <main>
    <article>
      <header>
        
        <h1>Reference - Docker</h1>

        
          <p>
            
              Published on <time datetime="2021-07-25">2021-07-25</time>
            
          </p>
        
        
        
        
      </header>
    
      
      







































  









  <h2 id="basic-commands"><a class="anchor" href="#basic-commands" title='Anchor for: Basic commands.'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a> Basic commands</h2> 

<ul>
<li>quickly run shell: <code>docker container run -it --rm alpine:latest sh</code></li>
<li>start a stopped container <code>docker container start -it [container_id] sh</code></li>
<li>stop a running container <code>docker container stop [conainer_id]</code></li>
<li>remove all containers <code>docker container rm -v $(docker ps -a -q)</code></li>
<li>custom mount volume <code>docker container run -it -v $(pwd):/host alpine:latest /bin/sh</code></li>
<li>run with custom port <code>docker container run -it --rm -v $(pwd):/src -p 8080:8080 -w /src golang:alpine /bin/sh</code></li>
<li>The -w flag we are passing is to set the working directory</li>
<li>running go files in docker: <code>docker container run -it --rm -v $(pwd):/src -w /src -p 8080:8080 golang:alpine go run reading_writing_json_8.go</code></li>
<li>remove container and also associated volumes to that container <code>docker container rm -v server</code></li>
</ul>





  <h2 id="networking"><a class="anchor" href="#networking" title='Anchor for: Networking.'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a> Networking</h2> 

<ul>
<li>
<p>networks present by default</p>
<ul>
<li>bridge : default network that your containers will connect to when you launch them</li>
<li>host: host network is essentially the same network that the Docker engine is running on. so, any port you expose will directly mapped to host machine. This restrict us from using multiple containers as only one port can be mapped to host and poses a security risk to container code. This is just like not using all the features of docker. One example which might use this is API gateway</li>
<li>none: containers have no network assigned</li>
<li>overlay: unique Docker network that is used to connect containers running on separate hosts to one another. Usually in prod you can use multiple hosts machines which can have instances of your app.</li>
<li>custom network drivers: develop your own plugins using open source libnetwork project. you can write it to be capable to connect to non docker applications and physical databases
<ul>
<li>weaveworks is a popular custom network driver, visualisations, service discovery etc</li>
<li>project calico - very fast custom network driver</li>
</ul>
</li>
<li>When you use a Docker network, Docker automatically adds a mapping to the containers resolve.conf pointing to the built in Docker DNS server, we can then contact other containers connected to the same network by referencing them by name.</li>
</ul>





  <h3 id="commands"><a class="anchor" href="#commands" title='Anchor for: commands.'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a> commands</h3> 

<ul>
<li>creating a new network
<ul>
<li><code>docker network create --driver bridge testnetwork</code></li>
</ul>
</li>
<li>connecting container to network
<code>docker run -it --rm -v $(pwd):/src -w /src --name server --network=testnetwork golang:alpine go run main.go</code></li>
</ul>
</li>
</ul>





  <h3 id="dockerfile"><a class="anchor" href="#dockerfile" title='Anchor for: Dockerfile.'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a> Dockerfile</h3> 

<ul>
<li>
<p>as you now see, we have long terminal commands. Dockerfiles will make this intuitive to write all the arguments in a file.</p>
</li>
<li>
<p>FROM</p>
<ul>
<li>which image is in use</li>
</ul>
</li>
<li>
<p>MAINTAINER</p>
<ul>
<li>maintainer of application or dockerfile</li>
</ul>
</li>
<li>
<p>EXPOSE</p>
<ul>
<li>does not expose to host</li>
<li>you still need to use -p flag to export to host</li>
</ul>
</li>
<li>
<p>ENTRYPOINT [&ldquo;executable&rdquo;, &ldquo;param1&rdquo;, &ldquo;param2&rdquo;]</p>
<ul>
<li>runs when container starts.</li>
<li>cannot override parameters</li>
<li>best approach is to have just executable in entrypoint</li>
</ul>
</li>
<li>
<p>CMD [ &ldquo;param1&rdquo;, &ldquo;param2&rdquo;]</p>
<ul>
<li>attached after entrypoint</li>
<li>act as default parameters</li>
<li>can be overriden when you pass extra params with run command</li>
<li>only one cmd per file is allowed</li>
</ul>
</li>
<li>
<p>build images from dockerfiles</p>
<ul>
<li>docker build -t imagename .
<ul>
<li>. is context: always optimize this, the whole context is copied to docker!! huge memory is required
<ul>
<li>it is not always possible to have only requrie files in context</li>
<li>so use a .dockerignore file</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>run the created image</p>
<ul>
<li><code>docker run --rm -p 8080:8080 testserver</code></li>
</ul>
</li>
</ul>





  <h3 id="docker-compose"><a class="anchor" href="#docker-compose" title='Anchor for: Docker compose.'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a> Docker compose</h3> 

<ul>
<li>Used to start multiple containers at once with your stack definition stored in a handy YAML file.</li>
<li>Container started, and service ready is not the same thing.
<ul>
<li>so depends-on might not works always</li>
</ul>
</li>
<li>docker-compose -f ./docker-compose.yml up</li>
<li>docker-compose -f ./docker-compose.yml rm -v : removes container and deletes all associated volumes</li>
<li>specify project name and override the default project names so that you can run multiple instances of the same service. As compose checks if a container with same name already running or not.
<ul>
<li>docker-compose -p testproject up</li>
</ul>
</li>
</ul>





  <h3 id="good-practices"><a class="anchor" href="#good-practices" title='Anchor for: Good Practices.'><svg aria-hidden="true"><use xlink:href="#hashtag"/></svg></a> Good Practices</h3> 

<ul>
<li>Always keep in mind the &ldquo;UNION FILE SYSTEM&rdquo;(important part for caching layers)</li>
<li>change in one layer requires all the next layers after it to rebuild</li>
<li>always try to chain RUN commands just to one, so you can reduce number of layers</li>
<li>organize COPY, copy your package managers list(package.json, go.mod etc) first and then the application code</li>
<li>do not have deamons(which will autostart containers when they crash) in docker(antipattern) but instead use orchestration mechanism</li>
<li>always try to use named volumes and named networks in docker compose file, they are really useful when you want to run multiple containers within same network or use same volumes</li>
</ul>



    </article>
  </main>


    </div>
    
    <footer>
      


  














<section class="req-js">
  <button class="outline-dashed" title="Change to light/dark mode."><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><use xlink:href="#adjust"/></svg></button><input class="outline-dashed" type="color" list="presets" value="#7fc121" title="Change accent color." aria-label="Change accent color."><datalist id="presets"><option value="#1dbc91"><option value="#7fc121"><option value="1dbc91"><option value="#dd587c"><option value="#f3a530"></datalist>
</section>



  <noscript>
    <p class="noscript">Unable to execute JavaScript. Some features were disabled.</p>
  </noscript>



    </footer>
    
    <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0" aria-hidden="true">
      <symbol viewBox="0 0 512 512" id="adjust">
        <path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/>
      </symbol>
      
      
      
      
  
<symbol viewBox="0 0 448 512" id="hashtag">
  <path d="M440.667 182.109l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l14.623-81.891C377.123 38.754 371.468 32 363.997 32h-40.632a12 12 0 0 0-11.813 9.891L296.175 128H197.54l14.623-81.891C213.477 38.754 207.822 32 200.35 32h-40.632a12 12 0 0 0-11.813 9.891L132.528 128H53.432a12 12 0 0 0-11.813 9.891l-7.143 40C33.163 185.246 38.818 192 46.289 192h74.81L98.242 320H19.146a12 12 0 0 0-11.813 9.891l-7.143 40C-1.123 377.246 4.532 384 12.003 384h74.81L72.19 465.891C70.877 473.246 76.532 480 84.003 480h40.632a12 12 0 0 0 11.813-9.891L151.826 384h98.634l-14.623 81.891C234.523 473.246 240.178 480 247.65 480h40.632a12 12 0 0 0 11.813-9.891L315.472 384h79.096a12 12 0 0 0 11.813-9.891l7.143-40c1.313-7.355-4.342-14.109-11.813-14.109h-74.81l22.857-128h79.096a12 12 0 0 0 11.813-9.891zM261.889 320h-98.634l22.857-128h98.634l-22.857 128z"/>
</symbol>


  <symbol viewBox="0 0 320 512" id="caret-down">
    <path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"/>
  </symbol>


      
      
      
    </svg>
    
    
    

    
    

  </body>
</html>
